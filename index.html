<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Noticias ONG</title>
  <style>
    body{font-family:Arial;max-width:900px;margin:20px auto;padding:20px;background:#fff}
    .card{border:1px solid #ddd;padding:12px;border-radius:8px;margin-bottom:12px}
    button{padding:8px 12px;border-radius:6px;border:none;background:#0077cc;color:#fff;cursor:pointer}
    .danger{background:#d9534f}
  </style>
</head>
<body>
  <h1>üì∞ Noticias ONG</h1>
  <button onclick="location.href='editor.html'">‚ûï Crear noticia</button>
  <div id="list"></div>

<script>
  // CONFIG (cambiar con tus datos)
  const OWNER = "desarrollomesacontralaescnna";
  const REPO = "noticias-ong";
  const BRANCH = "main";

  async function load() {
    const listEl = document.getElementById('list');
    listEl.innerHTML = '<p>Cargando...</p>';
    try {
      const resp = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/noticias?ref=${BRANCH}`);
      if (!resp.ok) throw new Error('Error al pedir noticias: ' + resp.status);
      const files = await resp.json();
      listEl.innerHTML = '';
      for (const f of files) {
        if (!f.name.endsWith('.md')) continue;
        const raw = await fetch(f.download_url).then(r=>r.text());
        const match = /^---([\s\S]*?)---/.exec(raw);
        let title = f.name.replace('.md',''), date='';
        if (match) {
          const yaml = match[1];
          title = /title:\s*"(.*?)"/.exec(yaml)?.[1] || title;
          date = /date:\s*"(.*?)"/.exec(yaml)?.[1] || '';
        }
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h3>${title}</h3><small>${date}</small>
          <div style="margin-top:8px">
            <button onclick="location.href='editor.html?slug=${f.name.replace('.md','')}'">‚úèÔ∏è Editar</button>
          </div>`;
        listEl.appendChild(card);
      }
    } catch (e) {
      listEl.innerHTML = '<p>No se pudieron cargar noticias. ' + e.message + '</p>';
    }
  }

  load();
</script>
</body>
</html>